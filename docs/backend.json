
{
  "entities": {
    "UserGroup": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserGroup",
      "type": "object",
      "description": "Represents a group of users within the family cookbook application, where members share recipes and other content.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user group."
        },
        "name": {
          "type": "string",
          "description": "Name of the user group."
        },
        "adminIds": {
          "type": "array",
          "description": "An array of user IDs who are administrators for this group.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "adminIds"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account within the family cookbook application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "The user's username."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "avatar": {
          "type": "string",
          "description": "An emoji or URL representing the user's avatar."
        },
        "userGroupId": {
          "type": "string",
          "description": "Reference to the UserGroup this user belongs to. (Relationship: UserGroup 1:N User)"
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "userGroupId"
      ]
    },
    "Recipe": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recipe",
      "type": "object",
      "description": "Represents a recipe within the family cookbook application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recipe."
        },
        "name": {
          "type": "string",
          "description": "Name of the recipe."
        },
        "source": {
          "type": "string",
          "description": "Source of the recipe (e.g., family member, cookbook)."
        },
        "prepTime": {
          "type": "string",
          "description": "The prep time for the recipe."
        },
        "cookTime": {
          "type": "string",
          "description": "The cook time for the recipe."
        },
        "totalTime": {
          "type": "string",
          "description": "Total time needed for the recipe."
        },
        "servings": {
          "type": "number",
          "description": "Number of servings the recipe makes."
        },
        "servingSize": {
          "type": "string",
          "description": "Size of each serving."
        },
        "freezable": {
          "type": "boolean",
          "description": "Indicates whether the recipe is suitable for freezing."
        },
        "instructions": {
          "type": "string",
          "description": "Instructions for preparing the recipe."
        },
        "pictureUrl": {
          "type": "string",
          "description": "URL of the recipe picture.",
          "format": "uri"
        },
        "userGroupId": {
          "type": "string",
          "description": "Reference to the UserGroup this recipe belongs to. (Relationship: UserGroup 1:N Recipe)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who created this recipe. (Relationship: User 1:N Recipe)"
        }
      },
      "required": [
        "id",
        "name",
        "instructions",
        "userGroupId",
        "userId"
      ]
    },
    "Ingredient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Ingredient",
      "type": "object",
      "description": "Represents an ingredient used in a recipe.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ingredient."
        },
        "name": {
          "type": "string",
          "description": "Name of the ingredient."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "RecipeIngredient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RecipeIngredient",
      "type": "object",
      "description": "Represents the relationship between a recipe and its ingredients, including the amount needed.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RecipeIngredient entry."
        },
        "recipeId": {
          "type": "string",
          "description": "Reference to the Recipe. (Relationship: Recipe 1:N RecipeIngredient)"
        },
        "ingredientId": {
          "type": "string",
          "description": "Reference to the Ingredient. (Relationship: Ingredient 1:N RecipeIngredient)"
        },
        "amount": {
          "type": "string",
          "description": "Amount of the ingredient needed for the recipe."
        },
        "unit": {
          "type": "string",
          "description": "Unit of measurement for the ingredient amount (e.g., cup, tbsp)."
        }
      },
      "required": [
        "id",
        "recipeId",
        "ingredientId",
        "amount"
      ]
    },
    "ShoppingList": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ShoppingList",
      "type": "object",
      "description": "Represents a shopping list for a user group.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the shopping list."
        },
        "name": {
          "type": "string",
          "description": "Name of the shopping list."
        },
        "userGroupId": {
          "type": "string",
          "description": "Reference to the UserGroup this shopping list belongs to. (Relationship: UserGroup 1:N ShoppingList)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who created this shopping list. (Relationship: User 1:N ShoppingList)"
        }
      },
      "required": [
        "id",
        "name",
        "userGroupId",
        "userId"
      ]
    },
    "ShoppingListItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ShoppingListItem",
      "type": "object",
      "description": "Represents an item on a shopping list.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the shopping list item."
        },
        "shoppingListId": {
          "type": "string",
          "description": "Reference to the ShoppingList. (Relationship: ShoppingList 1:N ShoppingListItem)"
        },
        "ingredientId": {
          "type": "string",
          "description": "Reference to the Ingredient. (Relationship: Ingredient 1:N ShoppingListItem)"
        },
        "amount": {
          "type": "string",
          "description": "Amount of the ingredient needed."
        },
        "unit": {
          "type": "string",
          "description": "Unit of measurement for the ingredient amount (e.g., cup, tbsp)."
        },
        "recipeId": {
          "type": "string",
          "description": "Reference to the Recipe this ingredient is for (optional). (Relationship: Recipe 1:N ShoppingListItem)"
        }
      },
      "required": [
        "id",
        "shoppingListId",
        "ingredientId",
        "amount"
      ]
    },
    "RecipeView": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RecipeView",
      "type": "object",
      "description": "Stores information about recipe views by guest users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the RecipeView entry."
        },
        "recipeId": {
          "type": "string",
          "description": "Reference to the Recipe being viewed. (Relationship: Recipe 1:N RecipeView)"
        },
        "viewedAt": {
          "type": "string",
          "description": "Timestamp of when the recipe was viewed.",
          "format": "date-time"
        },
        "guestIdentifier": {
          "type": "string",
          "description": "Unique identifier for the guest user (e.g., IP address, session ID)."
        }
      },
      "required": [
        "id",
        "recipeId",
        "viewedAt",
        "guestIdentifier"
      ]
    },
    "ActivityLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ActivityLog",
      "type": "object",
      "description": "Logs user activities within the application, such as adding or editing recipes.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the activity log entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User performing the action. (Relationship: User 1:N ActivityLog)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the activity occurred.",
          "format": "date-time"
        },
        "actionType": {
          "type": "string",
          "description": "Type of action performed (e.g., addRecipe, editRecipe, addToShoppingList)."
        },
        "recipeId": {
          "type": "string",
          "description": "Reference to the Recipe involved in the activity (if applicable). (Relationship: Recipe 1:N ActivityLog)"
        },
        "shoppingListId": {
          "type": "string",
          "description": "Reference to the ShoppingList involved in the activity (if applicable). (Relationship: ShoppingList 1:N ActivityLog)"
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the activity."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "actionType"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ],
    "customClaims": {
      "superAdmin": {
        "type": "boolean",
        "description": "Grants the user administrative privileges over the entire application, including managing user groups."
      }
    }
  },
  "firestore": {
    "structure": [
      {
        "path": "/user_groups/{userGroupId}",
        "definition": {
          "entityName": "UserGroup",
          "schema": {
            "$ref": "#/backend/entities/UserGroup"
          },
          "description": "Represents a group of users. Managed by group admins or a super-admin.",
          "params": [
            {
              "name": "userGroupId",
              "description": "The unique identifier of the user group."
            }
          ]
        }
      },
      {
        "path": "/user_groups/{userGroupId}/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Represents a user within a specific user group. Inherits group-level access control.",
          "params": [
            {
              "name": "userGroupId",
              "description": "The unique identifier of the user group."
            },
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/user_groups/{userGroupId}/recipes/{recipeId}",
        "definition": {
          "entityName": "Recipe",
          "schema": {
            "$ref": "#/backend/entities/Recipe"
          },
          "description": "Represents a recipe within a specific user group. Includes 'userId' for tracking the creator.",
          "params": [
            {
              "name": "userGroupId",
              "description": "The unique identifier of the user group."
            },
            {
              "name": "recipeId",
              "description": "The unique identifier of the recipe."
            }
          ]
        }
      },
      {
        "path": "/user_groups/{userGroupId}/shopping_lists/{shoppingListId}",
        "definition": {
          "entityName": "ShoppingList",
          "schema": {
            "$ref": "#/backend/entities/ShoppingList"
          },
          "description": "Represents a shopping list within a specific user group. Includes 'userId' for tracking the creator.",
          "params": [
            {
              "name": "userGroupId",
              "description": "The unique identifier of the user group."
            },
            {
              "name": "shoppingListId",
              "description": "The unique identifier of the shopping list."
            }
          ]
        }
      },
      {
        "path": "/user_groups/{userGroupId}/shopping_lists/{shoppingListId}/items/{itemId}",
        "definition": {
          "entityName": "ShoppingListItem",
          "schema": {
            "$ref": "#/backend/entities/ShoppingListItem"
          },
          "description": "Represents an item on a shopping list.",
          "params": [
            {
              "name": "userGroupId",
              "description": "The unique identifier of the user group."
            },
            {
              "name": "shoppingListId",
              "description": "The unique identifier of the shopping list."
            },
            {
              "name": "itemId",
              "description": "The unique identifier of the shopping list item."
            }
          ]
        }
      },
      {
        "path": "/recipe_views/{recipeViewId}",
        "definition": {
          "entityName": "RecipeView",
          "schema": {
            "$ref": "#/backend/entities/RecipeView"
          },
          "description": "Stores information about recipe views by guest users. No group association.",
          "params": [
            {
              "name": "recipeViewId",
              "description": "The unique identifier of the recipe view event."
            }
          ]
        }
      },
      {
        "path": "/activity_logs/{activityLogId}",
        "definition": {
          "entityName": "ActivityLog",
          "schema": {
            "$ref": "#/backend/entities/ActivityLog"
          },
          "description": "Logs user activities within the application. No group association.",
          "params": [
            {
              "name": "activityLogId",
              "description": "The unique identifier of the activity log entry."
            }
          ]
        }
      }
    ],
    "reasoning": "This design supports a two-tiered administrative system. A global 'super-admin' (identified by a custom claim) has universal privileges. Additionally, each 'user_group' has a list of 'adminIds' who can manage that specific group. This hybrid model allows for both centralized control and delegated group management.\n\nKey design choices and justifications:\n\n*   **/user_groups/{userGroupId}:** Each group is a top-level document. Management (create, update, delete) is restricted to the super-admin or group admins.\n*   **adminIds Field:** The `adminIds` array within each `user_group` document explicitly lists the UIDs of its administrators, avoiding costly `get()` calls in security rules.\n*   **/user_groups/{userGroupId}/users/{userId}:**  User membership is managed as a subcollection. Adding or removing users is restricted to group admins or the super-admin.\n*   **Content Segregation:** All group-specific content (recipes, shopping lists) is nested within the group's subcollections, ensuring data isolation and simplified security rules based on group membership.\n*   **/recipe_views and /activity_logs:** These top-level collections are for application-wide analytics and auditing. They are intentionally kept separate from group security constraints to allow for different, more open access patterns (e.g., append-only writes for guests or any authenticated user).\n\n**Authorization Independence (CRITICAL):**\n\n*   **Super-Admin:** The super-admin status is verified via the `request.auth.token.superAdmin` custom claim, which is fast and does not require a database read.\n*   **Group Admin:** A user's admin status for a group is checked by reading the `adminIds` array of the `user_group` document they are trying to manage.\n*   **Group Member:** A user's membership is confirmed by a fast `exists()` check on their user document within the group's `users` subcollection."
  }
}
